let update f v = Lwd.set v (f (Lwd.peek v))
